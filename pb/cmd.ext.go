// Code generated by pbgen. DO NOT EDIT.
// source: cmd.proto, cmd_req.proto, cmd_rsp.proto, cmd_dsp.proto

package pb

import (
	"encoding/binary"
	"errors"

	"google.golang.org/protobuf/proto"
)

var _parser = NewParser()

func init() {
	_parser.Load()
}

type message interface {
	proto.Message

	Key() EKey_T
}

type Package struct {
	msg   message
	err   EErrorCode_T
	bytes []byte
}

func NewPackage(msg proto.Message, errs ...EErrorCode_T) *Package {
	err := EErrorCode_Ok
	if len(errs) != 0 {
		err = errs[0]
	}
	return &Package{
		msg: msg.(message),
		err: err,
	}
}

func (p *Package) Key() EKey_T {
	return p.msg.Key()
}

func (p *Package) Marshal() ([]byte, error) {
	if len(p.bytes) != 0 {
		return p.bytes, nil
	}

	if p.msg == nil {
		return nil, errors.New("message is nil")
	}

	bytes := make([]byte, 4, 8)

	binary.LittleEndian.PutUint16(bytes[0:], uint16(p.msg.Key()))
	binary.LittleEndian.PutUint16(bytes[2:], uint16(p.err))

	if p.err != EErrorCode_Ok {
		return bytes, nil
	}

	body, marshalErr := proto.Marshal(p.msg)
	if marshalErr != nil {
		return nil, marshalErr
	}

	bodyLen := uint32(len(body))
	bytes = append(bytes, 0, 0, 0, 0)
	binary.LittleEndian.PutUint32(bytes[4:], bodyLen)
	bytes = append(bytes, body...)
	p.bytes = bytes

	return bytes, nil
}

func Unmarshal(key EKey_T, data []byte) proto.Message {
	return _parser.Unmarshal(key, data)
}

// parser handles protobuf message parsing by EKey
type parser struct {
	types map[EKey_T]func() proto.Message
}

// NewParser creates a new Parser instance
func NewParser() *parser {
	return &parser{
		types: make(map[EKey_T]func() proto.Message),
	}
}

// Register registers a message factory for a given EKey
func (p *parser) Register(key EKey_T, factory func() proto.Message) {
	p.types[key] = factory
}

// New creates a new message instance for the given EKey
func (p *parser) New(key EKey_T) proto.Message {
	factory, ok := p.types[key]
	if !ok {
		return nil
	}
	return factory()
}

// Unmarshal unmarshals binary data into a new message instance
func (p *parser) Unmarshal(key EKey_T, data []byte) proto.Message {
	msg := p.New(key)
	if msg == nil {
		return nil
	}
	if err := proto.Unmarshal(data, msg); err != nil {
		return nil
	}
	return msg
}

// Load registers all message types
func (p *parser) Load() {
	p.Register(EKey_Login, func() proto.Message { return &ReqLogin{} })
	p.Register(EKey_CreateRole, func() proto.Message { return &ReqCreateRole{} })
	p.Register(EKey_DeleteRole, func() proto.Message { return &ReqDeleteRole{} })
	p.Register(EKey_LoginRole, func() proto.Message { return &ReqLoginRole{} })
	p.Register(EKey_Ping, func() proto.Message { return &ReqPing{} })
	p.Register(EKey_PingXXX, func() proto.Message { return &ReqPingXXX{} })
	p.Register(EKey_EnterScene, func() proto.Message { return &ReqEnterScene{} })
	p.Register(EKey_TestEnter, func() proto.Message { return &ReqTestEnter{} })
	p.Register(EKey_Login, func() proto.Message { return &RspLogin{} })
	p.Register(EKey_CreateRole, func() proto.Message { return &RspCreateRole{} })
	p.Register(EKey_DeleteRole, func() proto.Message { return &RspDeleteRole{} })
	p.Register(EKey_LoginRole, func() proto.Message { return &RspLoginRole{} })
	p.Register(EKey_Ping, func() proto.Message { return &RspPing{} })
	p.Register(EKey_PingXXX, func() proto.Message { return &RspPingXXX{} })
	p.Register(EKey_EnterScene, func() proto.Message { return &RspEnterScene{} })
	p.Register(EKey_TestEnter, func() proto.Message { return &RspTestEnter{} })
	p.Register(EKey_LoginFast, func() proto.Message { return &DspLoginFast{} })
	p.Register(EKey_LoginData, func() proto.Message { return &DspLoginData{} })
	p.Register(EKey_ServerMaintain, func() proto.Message { return &DspServerMaintain{} })
	p.Register(EKey_KickRole, func() proto.Message { return &DspKickRole{} })
	p.Register(EKey_PreparedEnterScene, func() proto.Message { return &DspPreparedEnterScene{} })
	p.Register(EKey_Test, func() proto.Message { return &DspTest{} })
}

func (msg *ReqLogin) Key() EKey_T {
	return EKey_Login
}

func (msg *ReqLogin) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *ReqCreateRole) Key() EKey_T {
	return EKey_CreateRole
}

func (msg *ReqCreateRole) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *ReqDeleteRole) Key() EKey_T {
	return EKey_DeleteRole
}

func (msg *ReqDeleteRole) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *ReqLoginRole) Key() EKey_T {
	return EKey_LoginRole
}

func (msg *ReqLoginRole) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *ReqPing) Key() EKey_T {
	return EKey_Ping
}

func (msg *ReqPing) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *ReqPingXXX) Key() EKey_T {
	return EKey_PingXXX
}

func (msg *ReqPingXXX) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *ReqEnterScene) Key() EKey_T {
	return EKey_EnterScene
}

func (msg *ReqEnterScene) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *ReqTestEnter) Key() EKey_T {
	return EKey_TestEnter
}

func (msg *ReqTestEnter) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *RspLogin) Key() EKey_T {
	return EKey_Login
}

func (msg *RspLogin) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *RspCreateRole) Key() EKey_T {
	return EKey_CreateRole
}

func (msg *RspCreateRole) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *RspDeleteRole) Key() EKey_T {
	return EKey_DeleteRole
}

func (msg *RspDeleteRole) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *RspLoginRole) Key() EKey_T {
	return EKey_LoginRole
}

func (msg *RspLoginRole) Marshal() ([]byte, error) {
	return proto.Marshal(msg)
}

func (msg *RspPing) Key() EKey_T {
	return EKey_Ping
}
